{{ GRAMEX(cache=['G.min.js', 'results.csv', 'colors.csv', 'style.css', 'all.html']) }}{% code %}
title = 'Assembly Elections'
{% end %}<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8">
  <title class="title">{{ title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="cleartype" content="on">
  <style>
    {{ T('css/bootstrap.v3.min.css') }}
    {{ T('style.css') }}
  </style>
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144x144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114x114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72x72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57x57-precomposed.png">
  <link rel="shortcut icon" sizes="196x196" href="img/touch-icon-196x196.png">
  <link rel="shortcut icon" href="img/apple-touch-icon.png">
  <meta name="msapplication-TileImage" content="img/apple-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="{{ _color.Office.accent_4 }}">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="{{ title }}">
  <script>
      // Remove no-js class. Set no-touch upfront to ensure -webkit-scrollbar styling
      var touch_device = 'ontouchend' in document;
      document.documentElement.setAttribute('class', touch_device ? 'touch' : 'no-touch');
  </script>
</head><body>

<header>
  <div class="container">
    <h1 href="?ST_NAME=&YEAR=&AC_NAME=&PARTY=&BY=">
      <span class="heading">
        <span class="em">Assembly</span> Elections<span class="title"></span>
        <small>&mdash; every election at a glance</small>
      </span>
      <div style="float:right;font-size:20px;line-height:40px;text-align:right">
        <a class="show-help btn btn-default" data-toggle="button" href="#">Help</a>
      </div>
    </h1>
  </div>
</header>

<div class="container main">
  {{ T('all.html', DB=DB) }}

  <div id="results"></div>
</div>

<script>
{{ T('js/helper.js') }}

MBP.scaleFix();
MBP.startupImage();
MBP.hideUrlBarOnLoad();
MBP.enableActive();

// TODO: FastClick
if (window.FastClick)
  window.addEventListener('load', function() { FastClick.attach(document.body); }, false);

{{ T('js/jquery2.min.js') }}
{{ T('js/bootstrap.v3.min.js') }}
{{ T('js/d3.v3.min.js') }}
{{ T('js/G.min.js') }}
{{ T('js/jquery.scrollTo.min.js') }}

$('body')
  .tooltip({
    selector: '[title]',
    container: 'body',
    html: true
  })
  .highlight({
    selector: '.party-legend',
    target: '[data-party]'
  })
  .highlight({
    selector: '.state-legend',
    target: '[data-state]'
  })
  .highlight({
    selector: '.rank-legend',
    target: '[data-rank]'
  })
  .urlfilter({
    target: '#'
  })
  .aspect({
    selector: '[data-height]'
  })
  .on('click', '.show-help', function() {
    if ($(this).is('.active'))
      $('.help').tooltip('hide')
    else
      $('.help').dispatch(touch_device ? 'focus': 'mouseover')
  })

function post_load() {
  $('.tooltip').remove();
  $('.show-help').removeClass('active');
  // Resize the SVG we just loaded for aspect ratio
  $(window).dispatch('resize');
  scrolled = $.scrollTo('#results', {
    duration: 300,
    margin: true,
    offset: {top: -20}
  });
}

function redraw() {
  var query = G.url.parse(location.hash.replace(/^#/, ''));
  if (!query.search)
      $('#results').empty()
  else if (query.searchKey.ST_NAME && query.searchKey.AC_NAME && query.searchKey.YEAR)
      $('#results').load('state-ac-year?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.AC_NAME && query.searchKey.PARTY)
      $('#results').load('state-ac-party?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.YEAR && query.searchKey.PARTY)
      $('#results').load('state-party-year?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.AC_NAME)
      $('#results').load('state-ac?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.YEAR)
      $('#results').load('state-year?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.PARTY)
      $('#results').load('state-party?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.BY == 'PARTY')
      $('#results').load('state-by-party?' + query.search, post_load)
  else if (query.searchKey.ST_NAME && query.searchKey.BY == 'AC')
      $('#results').load('state-by-ac?' + query.search, post_load)
  else
      $('#results').html('Did not understand ' + query.search)
}

$(window).on('hashchange', redraw);
redraw();
</script>
</body></html>
{#

- Add help

- Multi-click is not obvious. Check box? Active state?
- Add filters: gender, caste, # candidates, etc

Multi-filters:
    - Women candidates
    - Anti-incumbent constituency
    -

Notes:
- Connect to iPad, display on device, help tell a story directly
- State-focus every week (schedule to be made available)
- Show the past trend of the state so far. State summary must be the most prominent.
- Anchors are not data and chart friendly. Need to make it easy for them
- Process
    - The issue calendar is the key driver of content
    - Brainstorming of stories
- State story


Lok Sabha next week

#}
