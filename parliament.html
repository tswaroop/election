{{ GRAMEX(cache=['js/G.min.js', 'style.css', 'parliament.csv', 'parliament-topics.csv']) }}{% code %}
title = 'Parliament Elections'
description = 'A visual guide to the history of Indian Parliament elections, from 1951 until today, by Gramener.'

from urllib import quote
from common import pc_setup
data, elections = DB.csv('parliament.csv', setup=pc_setup, dtype=object)
topics = pd.read_csv('parliament-topics.csv')
{% end %}<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8">
  <title class="title">{{ title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="cleartype" content="on">
  <link rel="stylesheet" href="{{ static_url('/css/bootstrap.v3.min.css') }}">
  <link rel="stylesheet" href="{{ static_url('style.css') }}">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{{ static_url('img/apple-touch-icon-144x144-precomposed.png') }}">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{{ static_url('img/apple-touch-icon-114x114-precomposed.png') }}">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{{ static_url('img/apple-touch-icon-72x72-precomposed.png') }}">
  <link rel="apple-touch-icon-precomposed" href="{{ static_url('img/apple-touch-icon-57x57-precomposed.png') }}">
  <link rel="shortcut icon" sizes="196x196" href="{{ static_url('img/touch-icon-196x196-precomposed.png') }}">
  <link rel="shortcut icon" href="{{ static_url('img/apple-touch-icon.png') }}">
  <meta name="msapplication-TileImage" content="{{ static_url('img/apple-touch-icon-144x144-precomposed.png') }}">
  <meta name="msapplication-TileColor" content="{{ _color.Office.accent_4 }}">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="{{ title }}">
  <meta name="description" content="{{ description }}">
  <meta property="og:image" content="{{ static_url('img/startup-tablet-landscape.png') }}">
  <meta property="twitter:image" content="{{ static_url('img/startup-tablet-landscape.png') }}">
  <meta property="og:description" content="{{ description }}">
  <meta property="twitter:description" content="{{ static_url('img/startup-tablet-landscape.png') }}">
  <script>
      // Remove no-js class. Set no-touch upfront to ensure -webkit-scrollbar styling
      var touch_device = 'ontouchend' in document;
      document.documentElement.setAttribute('class', touch_device ? 'touch' : 'no-touch');
  </script>
</head><body>

<header>
  <div class="container">
    <h1>
      <span class="heading home">
        <span class="em">Parliament</span> Elections<span class="title"></span>
        <small>in India</small>
      </span>

      <div class="pull-right">

        <div class="btn-group year-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-year">Year</span> <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li data-year=""><a href="?YEAR=">All years</a></li>
            {% for y in sorted(data['YEAR'].unique()) %}
              <li data-year="{{ y }}"><a href="?YEAR={{ y }}">{{ y }}</a></li>
            {% end %}
          </ul>
        </div>

        <div class="btn-group state-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-state">State</span> <span class="caret"></span>
          </button>
          <div class="dropdown-menu pull-right multicolumn" role="menu">
            <li data-state=""><a href="?STATE=">All states</a></li>
            {% for s in sorted(data['STATE'].unique()) %}
              <li data-state="{{ s }}"><a href="?STATE={{ quote(s) }}">{{ s.title() }}</a></li>
            {% end %}
          </div>
        </div>

        <div class="btn btn-default back"><i class="glyphicon glyphicon-arrow-left"></i> Back</div>
      </div>
    </h1>
  </div>
</header>

<div class="container">
  <div id="factoid">
    {% for i, row in topics.iterrows() %}
      <div class="topic" href="{{ row['link'] }}">
        <div class="thumbnail">
          <div class="img" style="background-image:url({{ static_url(row['image']) }})"></div>
          <div class="caption">
            <h3>{{ row['title'] }}</h3>
            <p>{{ markdown(row['content']) }}</p>
          </div>
        </div>
      </div>
    {% end %}
  </div>

  <div id="result"></div>
</div>

<script>
{{ T('js/helper.js') }}

MBP.scaleFix()
MBP.startupImage()
MBP.hideUrlBarOnLoad()
MBP.enableActive()

// TODO: Add FastClick
if (window.FastClick)
  window.addEventListener('load', function() { FastClick.attach(document.body); }, false);

{{ T('js/jquery2.min.js') }}
{{ T('js/bootstrap.v3.min.js') }}
{{ T('js/G.min.js') }}
{{ T('js/jquery.scrollTo.min.js') }}

$('body')
  .urlfilter({
    selector: '[href]:not(.abs-href)',
    target: '#'
  })

$('.back').on('click', function() { history.go(-1) })
$('.home').on('click', function() { location.hash = '#' })

function redraw() {
  var hash = location.hash.replace(/^#/, ''),
      query = G.url.parse(hash).searchKey;

  if (hash == '') {
    $('#result, .year-filter, .state-filter').hide()
    $('#factoid').show()
  } else {
    $('#factoid').hide()
    $('.year-filter').show()
    $('.state-filter')[hash.match(/^summary/) ? 'show' : 'hide']()
    $('#result').empty().load('pc-' + hash).show()
  }

  // Set the filters
  $('.current-year').text(query.YEAR || 'Year')
  $('.current-state').text(query.STATE || 'State')

  $('.active[data-year]').removeClass('active')
  $('.active[data-state]').removeClass('active')

  $('[data-year="' + query.YEAR + '"]').addClass('active')
  $('[data-state="' + query.STATE + '"]').addClass('active')

}

$(window).on('hashchange', redraw);
redraw();

</script>

</body></html>
