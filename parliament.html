{{ GRAMEX(cache=['js/G.min.js', 'style.css', 'parliament.csv', 'parliament-topics.csv', 'colors.csv', '.head.html']) }}{% code %}
title = 'Parliament Elections'
description = 'A visual guide to the history of Indian Parliament elections, from 1951 until today, by Gramener.'

import json
from urllib import quote
from common import pc_setup, slug, metric_names
data, elections = DB.csv('parliament.csv', setup=pc_setup, dtype=object)
topics = pd.read_csv('parliament-topics.csv')
years = sorted(data['YEAR'].unique())

{% end %}<!DOCTYPE html><html lang="en">
<head>
  {{ T('.head.html', title=title, static_url=static_url, description=description) }}
</head><body>

<header>
  <div class="container">
    <h1>
      <a class="heading direct-link" href="parliament">
        <i class="glyphicon glyphicon-home"></i>
        <span class="em">Parliament</span> Elections<span class="title"></span>
        <small>in India</small>
      </a>

      <div class="pull-right header-controls">

        <div class="btn-group year-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-year">Year</span> <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li data-year=""><a href="?YEAR=">All years</a></li>
            {% for y in years %}
              <li data-year="{{ y }}"><a href="?YEAR={{ y }}">{{ y }}</a></li>
            {% end %}
          </ul>
        </div>

        <div class="btn-group years-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-years">Years</span> <span class="caret"></span>
          </button>
          <div class="dropdown-menu pull-right" role="menu">
            <form class="years">
              {% for y in years %}
                <label>
                  <input type="checkbox" name="Y" value="{{ y }}"{{ ' checked' if y in args.get('Y', []) else '' }}> {{ y }}
                </label>
              {% end %}
              <p><button class="btn btn-primary" type="submit">Submit</button></p>
            </form>
          </div>
        </div>

        <div class="btn-group state-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-state">State</span> <span class="caret"></span>
          </button>
          <div class="dropdown-menu pull-right multicolumn" role="menu">
            <li data-state=""><a href="?STATE=">All states</a></li>
            {% for s in sorted(data['STATE'].unique()) %}
              <li data-state="{{ s }}"><a href="?STATE={{ quote(s) }}">{{ s.title() }}</a></li>
            {% end %}
          </div>
        </div>

        <div class="btn-group metric-filter">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="current-metric">Size</span> <span class="caret"></span>
          </button>
          <ul class="dropdown-menu pull-right" role="menu">
            {% for v in metric_names %}
              <li data-year="{{ v }}"><a href="?METRIC={{ quote(v) }}">{{ metric_names[v] }}</a></li>
            {% end %}
          </ul>
        </div>

      </div>
    </h1>
  </div>
</header>

<div class="container">

  <div id="summary"></div>

  <div id="factoid">
    {% for i, row in topics.iterrows() %}
      <div class="topic" href="{{ row['link'] }}">
        <div class="thumbnail">
          <div class="img" style="background-image:url({{ static_url(row['image']) }})"></div>
          <div class="caption">
            <h3>{{ row['title'] }}</h3>
            <p>{{ markdown(row['content']) }}</p>
          </div>
        </div>
      </div>
    {% end %}
  </div>

  <div id="result"></div>

  <div class="result-controls clearfix">
    <div class="pull-right">
      Show:
      <div class="btn-group">
        <a class="btn btn-default" href="?n=10">10</a>
        <a class="btn btn-default" href="?n=20">20</a>
        <a class="btn btn-default" href="?n=50">50</a>
        <a class="btn btn-default" href="?n=500">500</a>
      </div>
    </div>
  </div>
</div>

<script>
{{ T('js/helper.js') }}

MBP.scaleFix()
MBP.startupImage()
MBP.hideUrlBarOnLoad()
MBP.enableActive()

// TODO: Add FastClick
if (window.FastClick)
  window.addEventListener('load', function() { FastClick.attach(document.body); }, false);

{{ T('js/jquery2.min.js') }}
{{ T('js/bootstrap.v3.min.js') }}
{{ T('js/G.min.js') }}
{{ T('js/jquery.scrollTo.min.js') }}
{{ T('js/d3.v3.min.js') }}

var years = {{ json.dumps(years) }}

$('body')
  .tooltip({
    selector: '[title]',
    container: 'body',
    html: true
  })
  .urlfilter({
    selector: '[href]:not(.direct-link)',
    target: '#'
  })
  .highlight({
    selector: '.party-legend',
    target: '[data-party]'
  })
  .aspect({
    selector: '[data-height]'
  })
  .on('click', '.home', function() {
    location.hash = '#'
  })
  .on('click', '.party-unhighlight', function() {
    $(this).trigger('clear.g.highlight')
  })
  .on('click', '.dropdown-menu form', function(e) {
    e.stopPropagation()
  })
  .on('submit', '.years', function(e) {
    e.preventDefault()
    location.hash = '?' + $(this).serialize()
    $(this).parents('.dropdown-menu').trigger('click')
  })
  .on('click', 'a.heading', function(e) {
    if (!location.hash.replace(/^#/, '')) {
      e.preventDefault()
      location = '.'
    }
  })
  .on('keyup', function(e) {
    var hash = location.hash.replace(/^#/, ''),
        match = hash.match(/YEAR=(\d+)/),
        index
    if ($(e.target).is('body') && match) {
      index = years.indexOf(match[1])
      if (e.keyCode == 37 && index > 0) {
        location.hash = hash.replace(/YEAR=\d+/, 'YEAR=' + years[index - 1])
      } else if (e.keyCode == 39 && index < years.length - 1) {
        location.hash = hash.replace(/YEAR=\d+/, 'YEAR=' + years[index + 1])
      }
    }
  })

function redraw() {
  var hash = location.hash.replace(/^#/, ''),
      q = G.url.parse(hash),
      query = q.searchKey;

  if (q.pathname.match(/^(summary|year|result|cartogram|table|scatter)$/)) {
    $('#summary, #factoid').slideUp(250)
    $('.year-filter')[q.pathname.match(/scatter/) ? 'slideU' : 'show']()
    $('.years-filter')[q.pathname.match(/^$/) ? 'show' : 'hide']()
    $('.result-controls')[q.pathname.match(/cartogram|scatter/) ? 'hide' : 'show']()
    $('.state-filter')[q.pathname.match(/cartogram/) ? 'hide' : 'show']()
    $('.metric-filter')[q.pathname.match(/cartogram/) ? 'show' : 'hide']()
    $('#result').empty().load('pc-' + hash, function() {
      if (q.pathname.match(/cartogram|scatter/)) {
        $(window).dispatch('resize')
        $('#summary, #factoid').slideUp(250)
      }
      $('.tooltip').remove()
    }).show()
  } else {
    $('#result, .result-controls, .year-filter, .state-filter, .metric-filter').hide()
    $('#summary').empty().load('pc-index' + hash, function() {
      $('#summary, #factoid').show()
      $(window).dispatch('resize')
      $('.tooltip').remove()
    })
  }

  // Set the filters
  $('.current-year').text(query.YEAR || 'Year')
  $('.current-metric').text(query.METRIC || 'Size')
  $('.current-state').text(query.STATE || 'State')
  $('.years-filter input[type="checkbox"]').each(function() {
    var $this = $(this),
        years = q.searchKey.Y || []
    if (years.indexOf($(this).val()) >= 0) $this.prop('checked', true)
  })

  $('.active[data-year]').removeClass('active')
  $('.active[data-metric]').removeClass('active')
  $('.active[data-state]').removeClass('active')

  $('[data-year="' + query.YEAR + '"]').addClass('active')
  $('[data-metric="' + query.METRIC + '"]').addClass('active')
  $('[data-state="' + query.STATE + '"]').addClass('active')
}

$(window).on('hashchange', redraw);
redraw();

</script>
</body></html>
